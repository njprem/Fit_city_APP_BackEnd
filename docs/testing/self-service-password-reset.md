# Test Cases for Self-Service Password Reset

## 1. Functional Test Cases

| Test Case ID | Feature | Description | Steps | Expected Result |
|---|---|---|---|---|
| TC-PR-001 | Initiate Reset | Verify that a user can successfully initiate a password reset. | 1. Navigate to the password reset page. <br> 2. Enter a valid and registered email address. <br> 3. Click the "Reset Password" button. | The system sends an email with a One-Time Password (OTP) to the user's email address. The user is shown a confirmation message. |
| TC-PR-002 | Confirm Reset | Verify that a user can successfully reset their password with a valid OTP. | 1. Open the OTP email from the previous step. <br> 2. Enter the OTP, the new password, and confirm the new password on the reset confirmation page. <br> 3. Click the "Confirm" button. | The user's password is updated successfully. The user is redirected to the login page and can log in with the new password. |
| TC-PR-003 | Initiate Reset (Invalid Email) | Verify that the system handles invalid email formats. | 1. Navigate to the password reset page. <br> 2. Enter an invalid email address (e.g., "invalid-email"). <br> 3. Click the "Reset Password" button. | The system displays an error message indicating that the email format is invalid. No email is sent. |
| TC-PR-004 | Initiate Reset (Non-Existent User) | Verify that the system does not reveal whether an email address is registered. | 1. Navigate to the password reset page. <br> 2. Enter a valid but unregistered email address. <br> 3. Click the "Reset Password" button. | The system displays a generic confirmation message, similar to the one for a successful request, to prevent account enumeration. No email is sent. |
| TC-PR-005 | Confirm Reset (Expired OTP) | Verify that the system rejects expired OTPs. | 1. Initiate a password reset and receive an OTP. <br> 2. Wait for the OTP to expire (e.g., 15 minutes). <br> 3. Enter the expired OTP and a new password. <br> 4. Click the "Confirm" button. | The system displays an error message indicating that the OTP is expired. The password is not reset. |
| TC-PR-006 | Confirm Reset (Invalid OTP) | Verify that the system rejects invalid OTPs. | 1. Initiate a password reset and receive an OTP. <br> 2. Enter an incorrect OTP and a new password. <br> 3. Click the "Confirm" button. | The system displays an error message indicating that the OTP is invalid. The password is not a reset. |
| TC-PR-007 | Confirm Reset (Weak Password) | Verify that the system enforces password complexity rules. | 1. Initiate a password reset and receive a valid OTP. <br> 2. Enter the valid OTP and a new password that does not meet the complexity requirements (e.g., too short, no special characters). <br> 3. Click the "Confirm" button. | The system displays an error message detailing the password complexity requirements. The password is not reset. |
| TC-PR-008 | Invalidate Prior Tokens | Verify that a new reset request invalidates any previous OTPs. | 1. Initiate a password reset and receive an OTP (OTP1). <br> 2. Initiate another password reset for the same user and receive a new OTP (OTP2). <br> 3. Attempt to use OTP1 to reset the password. | The system displays an error message indicating that the OTP is invalid. The password is not reset. Only OTP2 is valid. |

## 2. Non-Functional Test Cases

| Test Case ID | Category | Description | Steps | Expected Result |
|---|---|---|---|---|
| TC-PR-NFR-001 | Security | Verify that OTPs are not stored in plaintext. | 1. Initiate a password reset. <br> 2. Access the database and inspect the `password_resets` table. | The `otp_hash` column should contain a hashed value, and the `otp_salt` column should be populated. The plaintext OTP should not be stored. |
| TC-PR-NFR-002 | Performance | Verify that the reset request and confirmation endpoints respond within an acceptable time. | 1. Use a performance testing tool to send a high volume of requests to the `POST /api/v1/auth/password/reset-request` and `POST /api/v1/auth/password/reset-confirm` endpoints. | The average response time should be under 2 seconds under normal load conditions. |
| TC-PR-NFR-003 | Reliability | Verify that the system handles mail delivery failures gracefully. | 1. Configure the system with invalid SMTP credentials. <br> 2. Initiate a password reset. | The system should return a 500 error and log the mail delivery failure. The generated OTP should be marked as consumed to prevent orphaned tokens. |
| TC-PR-NFR-004 | Privacy | Verify that API responses do not leak information about user existence. | 1. Call `POST /api/v1/auth/password/reset-request` with a registered email. <br> 2. Call the same endpoint with an unregistered email. | Both calls should return an identical success response (`{ "success": true }`). |
